<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Geospatial Data Science with Julia - 9&nbsp; Geospatial joins</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./10-correlation.html" rel="next">
<link href="./08-splitcombine.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-splitcombine.html">Part III: Queries</a></li><li class="breadcrumb-item"><a href="./09-geojoins.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geospatial joins</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Geospatial Data Science with Julia</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./foreword.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Part I: Foundations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-geodata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">What is geospatial data?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-geoviz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Scientific visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-geoio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Interfacing with GIS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-geoproc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Geometric processing</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part II: Transforms</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-transforms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">What are transforms?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-projections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Map projections üöß</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-pipelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Building pipelines</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part III: Queries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-splitcombine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Split-apply-combine</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-geojoins.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geospatial joins</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Part IV: Interpolation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Geospatial correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Simple interpolation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Part V: Applications</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-mining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Mineral deposits</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-agriculture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Agricultural fields üöß</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-energy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Petroleum reservoirs üöß</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#motivation" id="toc-motivation" class="nav-link active" data-scroll-target="#motivation"><span class="header-section-number">9.1</span> Motivation</a></li>
  <li><a href="#joining-geotables" id="toc-joining-geotables" class="nav-link" data-scroll-target="#joining-geotables"><span class="header-section-number">9.2</span> Joining geotables</a></li>
  <li><a href="#common-predicates" id="toc-common-predicates" class="nav-link" data-scroll-target="#common-predicates"><span class="header-section-number">9.3</span> Common predicates</a></li>
  <li><a href="#multiple-matches" id="toc-multiple-matches" class="nav-link" data-scroll-target="#multiple-matches"><span class="header-section-number">9.4</span> Multiple matches</a></li>
  <li><a href="#congratulations" id="toc-congratulations" class="nav-link" data-scroll-target="#congratulations"><span class="header-section-number">9.5</span> Congratulations!</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-splitcombine.html">Part III: Queries</a></li><li class="breadcrumb-item"><a href="./09-geojoins.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geospatial joins</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Geospatial joins</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Another important tool in geospatial data science is the <strong>geospatial join</strong>. We will introduce the concept with a practical example, and will explain how it is related to the standard <a href="https://en.wikipedia.org/wiki/Join_(SQL)">join</a> of two tables.</p>
<section id="motivation" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="motivation"><span class="header-section-number">9.1</span> Motivation</h2>
<p>The split-apply-combine pattern that we learned in the previous chapter requires a <strong>single</strong> geotable with all the relevant information in it. However, many questions in geospatial data science can only be answered with information that is spread across <strong>multiple</strong> geotables. Hence, the need to <strong>join</strong> these geotables before attempting to <code>@groupby</code>, <code>@transform</code> and <code>@combine</code> the information.</p>
<p>Let‚Äôs consider a simple example where we are given two geotables, one containing people who shared their latitude and longitude coordinates:</p>
<div id="dcb03da8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> (</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  NAME<span class="op">=</span>[<span class="st">"John"</span>, <span class="st">"Mary"</span>, <span class="st">"Paul"</span>, <span class="st">"Anne"</span>, <span class="st">"Kate"</span>],</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  AGE<span class="op">=</span>[<span class="fl">34.0</span>, <span class="fl">12.0</span>, <span class="fl">23.0</span>, <span class="fl">39.0</span>, <span class="fl">28.0</span>]u<span class="st">"yr"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  HEIGHT<span class="op">=</span>[<span class="fl">1.78</span>, <span class="fl">1.56</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.72</span>]u<span class="st">"m"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  LATITUDE<span class="op">=</span>[<span class="op">-</span><span class="fl">22.96710361241228</span>, <span class="fl">37.42773662442142</span>, <span class="op">-</span><span class="fl">27.486220858775997</span>, <span class="fl">39.90358408375064</span>, <span class="op">-</span><span class="fl">3.847311538763359</span>],</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  LONGITUDE<span class="op">=</span>[<span class="op">-</span><span class="fl">43.17891118844475</span>, <span class="op">-</span><span class="fl">122.17007072663823</span>, <span class="fl">153.04380578036657</span>, <span class="fl">116.40764745941036</span>, <span class="op">-</span><span class="fl">32.411372812211226</span>]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>people <span class="op">=</span> <span class="fu">georef</span>(table, (<span class="op">:</span>LONGITUDE, <span class="op">:</span>LATITUDE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>5√ó4 GeoTable over 5 PointSet{2,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Point2</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">(-43.1789, -22.9671)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">(-122.17, 37.4277)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">(153.044, -27.4862)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">(116.408, 39.9036)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Kate</td>
<td style="text-align: center;">28.0 yr</td>
<td style="text-align: center;">1.72 m</td>
<td style="text-align: center;">(-32.4114, -3.84731)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>And another containing countries in the world according to the <a href="https://www.naturalearthdata.com">Natural Earth</a> project:</p>
<div id="8eb22942" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">GeoIO</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>countries <span class="op">=</span> GeoIO.<span class="fu">load</span>(<span class="st">"data/countries.geojson"</span>, numbertype <span class="op">=</span> <span class="dt">Float64</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>177√ó3 GeoTable over 177 GeometrySet{2,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">MultiPolygon</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Fiji</td>
<td style="text-align: center;">Melanesia</td>
<td style="text-align: center;">Multi(3√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Tanzania</td>
<td style="text-align: center;">Eastern Africa</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">W. Sahara</td>
<td style="text-align: center;">Northern Africa</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Canada</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">Multi(30√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">Multi(10√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Kazakhstan</td>
<td style="text-align: center;">Central Asia</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Uzbekistan</td>
<td style="text-align: center;">Central Asia</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Papua New Guinea</td>
<td style="text-align: center;">Melanesia</td>
<td style="text-align: center;">Multi(4√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Indonesia</td>
<td style="text-align: center;">South-Eastern Asia</td>
<td style="text-align: center;">Multi(13√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Argentina</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">‚ãÆ</td>
<td style="text-align: right;">‚ãÆ</td>
<td style="text-align: right;">‚ãÆ</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>georef</code> function has a method that accepts the names of columns with geospatial coordinates. In this example, the <code>table</code> already has the <code>LATITUDE</code> and <code>LONGITUDE</code> coordinates.</p>
</div>
</div>
<p>Let‚Äôs visualize the geometries of these two geotables:</p>
<div id="3194c7d2" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> Mke.<span class="fu">Figure</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> Mke.<span class="fu">Axis</span>(fig[<span class="fl">1</span>,<span class="fl">1</span>], title <span class="op">=</span> <span class="st">"People and countries"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>              xlabel <span class="op">=</span> <span class="st">"longitude"</span>, ylabel <span class="op">=</span> <span class="st">"latitude"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">viz!</span>(countries.geometry)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">viz!</span>(people.geometry, color <span class="op">=</span> <span class="st">"teal"</span>, pointsize <span class="op">=</span> <span class="fl">10</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>fig</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>‚îå Warning: Found `resolution` in the theme when creating a `Scene`. The `resolution` keyword for `Scene`s and `Figure`s has been deprecated. Use `Figure(; size = ...` or `Scene(; size = ...)` instead, which better reflects that this is a unitless size and not a pixel resolution. The key could also come from `set_theme!` calls or related theming functions.
‚îî @ Makie ~/.julia/packages/Makie/ND0gA/src/scenes.jl:220</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>
<figure class="figure">
<p><img src="09-geojoins_files/figure-html/cell-5-output-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Our goal in this example is to attach the ‚ÄúCOUNTRY‚Äù and ‚ÄúREGION‚Äù information to each individual based on their location, represented as a point. In other words, we want to find the <code>countries</code> that <strong>contain the location</strong>, and then copy the columns to the <code>people</code>.</p>
</section>
<section id="joining-geotables" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="joining-geotables"><span class="header-section-number">9.2</span> Joining geotables</h2>
<p>The <code>geojoin</code> function can be used to join two geotables using a <strong>geometric predicate</strong> function:</p>
<div id="0ec60d02" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(people, countries, pred <span class="op">=</span> <span class="op">‚àà</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>5√ó6 GeoTable over 5 PointSet{2,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Point2</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">(-43.1789, -22.9671)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">(-122.17, 37.4277)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">(153.044, -27.4862)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">(116.408, 39.9036)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Kate</td>
<td style="text-align: center;">28.0 yr</td>
<td style="text-align: center;">1.72 m</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">(-32.4114, -3.84731)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In the example above, we used the <code>‚àà</code> predicate to check if a <code>Point</code> in the <code>people</code> geotable is in a <code>MultiPolygon</code> in the <code>countries</code> geotable. The default predicate in <code>geojoin</code> is the <code>intersects</code> function that we covered in previous chapters.</p>
<p>Notice that Kate‚Äôs ‚ÄúCOUNTRY‚Äù and ‚ÄúREGION‚Äù are <code>missing</code>. That is because Kate lives in the <a href="https://en.wikipedia.org/wiki/Fernando_de_Noronha">Fernando de Noronha</a> island, which is not present in the <code>countries</code> geotable. To retain just those people for which the geometric predicate evaluates <code>true</code>, we can use a different <code>kind</code> of <code>geojoin</code> known as <code>inner</code>:</p>
<div id="fc2be04f" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(people, countries, kind <span class="op">=</span> <span class="op">:</span>inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>4√ó6 GeoTable over 4 view(::PointSet{2,Float64}, [1, 2, 3, 4])</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Point2</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">(-43.1789, -22.9671)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">(-122.17, 37.4277)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">(153.044, -27.4862)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">(116.408, 39.9036)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>By default, the <code>left</code> kind is used. Like in standard join, the <code>geojoin</code> is not commutative. If we swap the order of the geotables, the result will be different:</p>
<div id="f4c0590f" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(countries, people, kind <span class="op">=</span> <span class="op">:</span>inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>4√ó6 GeoTable over 4 view(::GeometrySet{2,Float64}, [5, 30, 138, 140])</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">MultiPolygon</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">Multi(10√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To learn about the different <code>kind</code>s of join, check DataFrames.jl‚Äôs <a href="https://dataframes.juliadata.org/stable/man/joins">documentation on joins</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In database-style join, the predicate function <code>isequal</code> is applied to arbitrary columns of tables. In <code>geojoin</code>, <strong>geometric predicate</strong> functions are applied to the <code>geometry</code> column of geotables.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip for all users
</div>
</div>
<div class="callout-body-container callout-body">
<p>Besides <code>geojoin</code>, the framework also provides vertical and horizontal concatenation of geotables. Vertical concatenation is achieved with <code>vcat</code> as follows:</p>
<div id="d8e5f3ac" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>gt1 <span class="op">=</span> <span class="fu">georef</span>((a<span class="op">=</span>[<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>], b<span class="op">=</span>[<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>]))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>gt2 <span class="op">=</span> <span class="fu">georef</span>((b<span class="op">=</span>[<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>], c<span class="op">=</span>[<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>]))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vcat</span>(gt1, gt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>6√ó4 GeoTable over 6 GeometrySet{1,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">a</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">c</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Segment</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>All columns are preserved by default, which corresponds to the option <code>kind = :union</code>. Absent columns are filled with <code>missing</code> values. The option <code>kind = :intersect</code> can be used to retain only the columns that are present in all geotables:</p>
<div id="404ba0d5" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcat</span>(gt1, gt2, kind <span class="op">=</span> <span class="op">:</span>intersect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>6√ó2 GeoTable over 6 GeometrySet{1,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Segment</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">6</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">5</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">6</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Horizontal concatenation is achieved with <code>hcat</code> as follows:</p>
<div id="1116b54c" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(gt1, gt2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>3√ó5 GeoTable over 3 CartesianGrid{1,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">a</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b_</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">c</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Segment</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Unique column names are produced with underscore suffixes whenever a column appears in multiple geotables. Julia provides convenient syntax for <code>vcat</code> and <code>hcat</code>:</p>
<div id="3542644a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>[gt1</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> gt2]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>6√ó4 GeoTable over 6 GeometrySet{1,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">a</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">c</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Segment</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">missing</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">missing</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="57713d40" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>[gt1 gt2]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>3√ó5 GeoTable over 3 CartesianGrid{1,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">a</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">b_</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">c</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Segment</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">Segment((0.0,), (1.0,))</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">Segment((1.0,), (2.0,))</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">Segment((2.0,), (3.0,))</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="common-predicates" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="common-predicates"><span class="header-section-number">9.3</span> Common predicates</h2>
<p>In geospatial data science, the most common geometric predicates used in <code>geojoin</code> are <code>‚àà</code>, <code>‚äÜ</code>, <code>==</code>, <code>‚âà</code> and <code>intersects</code> as illustrated in <a href="#tbl-predicate" class="quarto-xref">Table&nbsp;<span>9.1</span></a>. Specific applications may require custom predicates, which can be easily defined in pure Julia with the Meshes.jl module. For example, it is sometimes convenient to define geometric predicates in terms of a distance and a threshold:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pred</span>(g1, g2) <span class="op">=</span> <span class="fu">evaluate</span>(<span class="fu">Euclidean</span>(), <span class="fu">centroid</span>(g1), <span class="fu">centroid</span>(g2)) <span class="op">‚â§</span> <span class="fl">1</span>u<span class="st">"m"</span><span class="ss">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-predicate" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-predicate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9.1: Common geometric predicates in geospatial join
</figcaption>
<div aria-describedby="tbl-predicate-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">PREDICATE</th>
<th style="text-align: center;">EXAMPLE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">‚àà</td>
<td style="text-align: center;"><img src="images/in.png" class="img-fluid figure-img"></td>
</tr>
<tr class="even">
<td style="text-align: center;">‚äÜ</td>
<td style="text-align: center;"><img src="images/subseteq.png" class="img-fluid figure-img"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">==</td>
<td style="text-align: center;"><img src="images/isequal.png" class="img-fluid figure-img"></td>
</tr>
<tr class="even">
<td style="text-align: center;">‚âà</td>
<td style="text-align: center;"><img src="images/isapprox.png" class="img-fluid figure-img"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">intersects</td>
<td style="text-align: center;"><img src="images/intersects.png" class="img-fluid figure-img"></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="multiple-matches" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="multiple-matches"><span class="header-section-number">9.4</span> Multiple matches</h2>
<p>Sometimes the predicate function will evaluate <code>true</code> for multiple rows of the geotables. In this case, we need to decide which value will be copied to the resulting geotable. The <code>geojoin</code> accepts reduction functions for each column. For example, suppose that Kate decided to move to the continent:</p>
<div id="8a0c5b06" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> (</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  NAME<span class="op">=</span>[<span class="st">"John"</span>, <span class="st">"Mary"</span>, <span class="st">"Paul"</span>, <span class="st">"Anne"</span>, <span class="st">"Kate"</span>],</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  AGE<span class="op">=</span>[<span class="fl">34.0</span>, <span class="fl">12.0</span>, <span class="fl">23.0</span>, <span class="fl">39.0</span>, <span class="fl">28.0</span>]u<span class="st">"yr"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  HEIGHT<span class="op">=</span>[<span class="fl">1.78</span>, <span class="fl">1.56</span>, <span class="fl">1.70</span>, <span class="fl">1.80</span>, <span class="fl">1.72</span>]u<span class="st">"m"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  LATITUDE<span class="op">=</span>[<span class="op">-</span><span class="fl">22.96710361241228</span>, <span class="fl">37.42773662442142</span>, <span class="op">-</span><span class="fl">27.486220858775997</span>, <span class="fl">39.90358408375064</span>, <span class="op">-</span><span class="fl">9.66628224039543</span>],</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  LONGITUDE<span class="op">=</span>[<span class="op">-</span><span class="fl">43.17891118844475</span>, <span class="op">-</span><span class="fl">122.17007072663823</span>, <span class="fl">153.04380578036657</span>, <span class="fl">116.40764745941036</span>, <span class="op">-</span><span class="fl">35.71261407423411</span>]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>people <span class="op">=</span> <span class="fu">georef</span>(table, (<span class="op">:</span>LONGITUDE, <span class="op">:</span>LATITUDE))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>5√ó4 GeoTable over 5 PointSet{2,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Point2</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">(-43.1789, -22.9671)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">(-122.17, 37.4277)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">(153.044, -27.4862)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">(116.408, 39.9036)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Kate</td>
<td style="text-align: center;">28.0 yr</td>
<td style="text-align: center;">1.72 m</td>
<td style="text-align: center;">(-35.7126, -9.66628)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now, both John and Kate live in Brazil according the <code>countries</code> geotable:</p>
<div id="319c3176" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(people, countries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>5√ó6 GeoTable over 5 PointSet{2,Float64}</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Point2</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.78 m</td>
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">(-43.1789, -22.9671)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">(-122.17, 37.4277)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">(153.044, -27.4862)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">(116.408, 39.9036)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Kate</td>
<td style="text-align: center;">28.0 yr</td>
<td style="text-align: center;">1.72 m</td>
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">(-35.7126, -9.66628)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>If we swap the order of the geotables in the <code>geojoin</code>, we need to decide how to reduce the multiple values of ‚ÄúNAME‚Äù, ‚ÄúAGE‚Äù and ‚ÄúHEIGHT‚Äù in the resulting geotable. By default, the <code>mean</code> function is used to reduce <code>Continuous</code> variables, and the <code>first</code> function is used otherwise:</p>
<div id="0d1f7c73" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(countries, people, kind <span class="op">=</span> <span class="op">:</span>inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>4√ó6 GeoTable over 4 view(::GeometrySet{2,Float64}, [5, 30, 138, 140])</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">MultiPolygon</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">Multi(10√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">John</td>
<td style="text-align: center;">31.0 yr</td>
<td style="text-align: center;">1.75 m</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can specify custom reduction functions using the following syntax:</p>
<div id="34d8f779" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(countries, people, <span class="st">"AGE"</span> <span class="op">=&gt;</span> maximum, <span class="st">"HEIGHT"</span> <span class="op">=&gt;</span> mean, kind <span class="op">=</span> <span class="op">:</span>inner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>4√ó6 GeoTable over 4 view(::GeometrySet{2,Float64}, [5, 30, 138, 140])</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">COUNTRY</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">REGION</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AGE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">HEIGHT</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">geometry</th>
</tr>
<tr class="odd subheader">
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Categorical</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Continuous</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">MultiPolygon</th>
</tr>
<tr class="header subheader headerLastRow">
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[NoUnits]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[yr]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">[m]</th>
<th style="text-align: center;" data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">United States of America</td>
<td style="text-align: center;">Northern America</td>
<td style="text-align: center;">Mary</td>
<td style="text-align: center;">12.0 yr</td>
<td style="text-align: center;">1.56 m</td>
<td style="text-align: center;">Multi(10√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">Brazil</td>
<td style="text-align: center;">South America</td>
<td style="text-align: center;">John</td>
<td style="text-align: center;">34.0 yr</td>
<td style="text-align: center;">1.75 m</td>
<td style="text-align: center;">Multi(1√óPolyArea)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Australia</td>
<td style="text-align: center;">Australia and New Zealand</td>
<td style="text-align: center;">Paul</td>
<td style="text-align: center;">23.0 yr</td>
<td style="text-align: center;">1.7 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
<tr class="even">
<td style="text-align: center;">China</td>
<td style="text-align: center;">Eastern Asia</td>
<td style="text-align: center;">Anne</td>
<td style="text-align: center;">39.0 yr</td>
<td style="text-align: center;">1.8 m</td>
<td style="text-align: center;">Multi(2√óPolyArea)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The keyword arguments <code>kind</code> and <code>pred</code> must appear at the end of the <code>geojoin</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">geojoin</span>(gt1, gt2, var1 <span class="op">=&gt;</span> red1, <span class="op">...</span>, varn <span class="op">=&gt;</span> redn; kind <span class="op">=</span> <span class="op">:</span>left, pred <span class="op">=</span> intersects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="congratulations" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="congratulations"><span class="header-section-number">9.5</span> Congratulations!</h2>
<p>Congratulations on finishing <strong>Part III</strong> of the book. Let‚Äôs quickly review what we learned so far:</p>
<ul>
<li>In order to answer geoscientific questions with <code>@groupby</code>, <code>@transform</code> and <code>@combine</code>, we need a single geotable with all the relevant information. This single geotable is often the result of a <code>geojoin</code> with multiple geotables from different sources of information.</li>
<li>There are various <code>kind</code>s of <code>geojoin</code> such as <code>inner</code> and <code>left</code>, which match the behavior of standard join in databases. We recommend the DataFrames.jl documentation to learn more.</li>
<li>The <code>geojoin</code> produces matches with <strong>geometric predicate</strong> functions. The most common are illustrated in <a href="#tbl-predicate" class="quarto-xref">Table&nbsp;<span>9.1</span></a>, but custom predicates can be easily defined in pure Julia using functions defined in the Meshes.jl module.</li>
</ul>
<p>In the next part of the book, you will learn a final important tool that is missing in our toolkit for advanced geospatial data science. The concepts in the following chapters are extremely important.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./08-splitcombine.html" class="pagination-link" aria-label="Split-apply-combine">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Split-apply-combine</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./10-correlation.html" class="pagination-link" aria-label="Geospatial correlation">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Geospatial correlation</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>